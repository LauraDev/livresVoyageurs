{# This page inherits from base.html #}
{% extends 'layout.html.twig' %}

{# Define Title #}
{% block title %} Livres Disponibles {% endblock %}

{#  Breadcrumb trail #}
{% set active_page = 'Disponible' %}


{# Define Content #}
{% block content %}

    <div class="row">

        <h1> Livres disponibles </h1>

        <!-- List: liberated books -->
        <div class="row">
            {% if bookList is empty %}
                <div>
                    <p> Aucun livre n'a encore été libéré sur ce site.</p>
                </div>
            {% else %}
                {% for book in bookList %}
                    <div class="card col-md-12">
                        <img class="card-img-top img img-responsive col-md-2" src="{{ book.photo_book }}" alt="Card image cap">
                        <div class="card-block col-md-10">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <h4 class="card-title">{{ book.title_book }}</h4>
                                    <p> {{ book.summary_book | replace({"&#39;" : "'"})}} </p>
                                </li>
                                <li class="list-group-item">Auteur: {{ book.firstname_author }} {{ book.lastname_author }}</li>
                                <li class="list-group-item">

                                    {# Display the pseudo of the member in possession of the book#}
                                    {% if book.pseudo_capture == 'none' %}
                                        <p>Membre partageant ce livre: {{ book.pseudo_member }}</p>
                                    {% else %}
                                        <p>Membre partageant ce livre: {{ book.pseudo_capture }}</p>
                                    {% endif %}

                                    {# If the user is connected (a member) allow him to contact the member who has the book #}
                                    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                                        {# If the 2 members are not already in contact #}
                                        {% if global.request.get('addFriend') == 'success' and global.request.get('friend') == book.pseudo_capture or global.request.get('addFriend') == 'success' and global.request.get('friend') == book.pseudo_member %}
                                            <div class="alert alert-success">
                                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                                    Votre demande a bien été effectuée.
                                                </p>
                                            </div>
                                        {% endif %}
                                        {#  If one of the 2 members already asked for contact #}
                                        {% if global.request.get('addFriend') == 'exist' and global.request.get('friend') == book.pseudo_capture or global.request.get('addFriend') == 'exist' and global.request.get('friend') == book.pseudo_member %}
                                            <div class="alert alert-danger">
                                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                                    Demande en attente.
                                                </p>
                                            </div>
                                        {% endif %}
                                        {# Create the path to contact the member who has the book #}
                                        {% if book.pseudo_capture == 'none' %}
                                            {% if book.pseudo_member != app.user.pseudo_member %}
                                                <a href="{{ path('livresVoyageurs_addFriend', {pseudo:  book.pseudo_member} ) }}" alt="ajouter ce membre en ami" class="btn btn-primary"> Entrer en contact * </a> 
                                                <p> * En cliquant sur ce bouton, j'accepte de transmettre mon adresse e-mail à ce contact</p>
                                            {% endif %}
                                        {% else %}
                                            {% if book.pseudo_capture != app.user.pseudo_member %}
                                                <a href="{{ path('livresVoyageurs_addFriend', {pseudo:  book.pseudo_capture} ) }}" alt="ajouter ce membre en ami" class="btn btn-primary"> Entrer en contact *</a> 
                                                <p> * En cliquant sur ce bouton, j'accepte de transmettre mon adresse e-mail à ce contact</p>
                                            {% endif %}
                                        {% endif %}

                                    {# If the user is not connected #}
                                    {% else %}
                                        <a href="{{ path('livresVoyageurs_inscription') }}" alt="Liens vers l'inscription" class="btn btn-primary"> Inscrivez-vous pour capturer ce livre </a>
                                    {% endif %}
                                </li>
                                <div class="card-footer text-muted">
                                    <li>Date de libération: {{ book.date_book | date("d/m/Y")  }}</li>
                                </div>
                                <a href="{{ path('livresVoyageurs_history', {id_book: book.id_book } ) }}" title="Lien vers l'histoire du livre"  class="btn btn-primary col-md-12">Suivre son chemin</a>
                            </ul>
                        </div> <!-- card block -->
                    </div> <!-- card col-md -->
                {% endfor %}
            {% endif %} <!-- list empty -->
        </div> <!-- row -->


    </div>

{% endblock %}


{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('assets/css/style/bookList/bookList.min.css') }}">
{% endblock %}